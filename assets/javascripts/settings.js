// Generated by CoffeeScript 1.6.3
(function() {
  var HandlebarsPluginSettings;

  HandlebarsPluginSettings = (function() {
    function HandlebarsPluginSettings() {
      var _this = this;
      $('#new-handlebars-user').click(function(event) {
        event.preventDefault();
        return _this.new_user(event.target);
      });
      $('.handlebars-users select[multiple]').each(function(idx, el) {
        return _this.adjust_list_size(el);
      });
      $(document).on('click', '.remove-handlebars-user', function(event) {
        event.preventDefault();
        $(event.target).parents('tr').first().remove();
        return _this.update_json_setting();
      });
      $(document).on('change', '.handlebars-users select', function() {
        return _this.update_json_setting();
      });
      true;
    }

    HandlebarsPluginSettings.prototype.adjust_list_size = function(select) {
      var count;
      count = $(select).find('option').length;
      if (count > 10) {
        count = 10;
      }
      return $(select).attr('size', count);
    };

    HandlebarsPluginSettings.prototype.new_user = function(link) {
      var template,
        _this = this;
      template = $($(link).data('template'));
      template.find('select[multiple]').each(function(idx, el) {
        return _this.adjust_list_size(el);
      });
      $(link).prev().find('tbody').append(template);
      return true;
    };

    HandlebarsPluginSettings.prototype.update_json_setting = function() {
      var manager_users,
        _this = this;
      manager_users = {};
      $('.handlebars-users tr').each(function(idx, el) {
        var manager, users;
        manager = $('select', el).first().val();
        users = $('select', el).last().val();
        return manager_users[manager] = users;
      });
      return $('#settings_users').val(JSON.stringify(manager_users));
    };

    return HandlebarsPluginSettings;

  })();

  jQuery(function() {
    return window.handlebarsPluginSettings = new HandlebarsPluginSettings();
  });

}).call(this);
